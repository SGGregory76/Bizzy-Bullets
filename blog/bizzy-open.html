<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Prologue - HustleTrap</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
    }
    #game {
      width: 100%;
      max-width: 480px;
      margin: auto;
      padding: 1em;
    }
    .question-box, .combat-ui, .stash-grid, .reward-box, .stash-result-box, .combat-result-box {
      margin: 1em 0;
      padding: 1em;
      border: 2px solid #444;
      border-radius: 10px;
      background: #222;
      text-align: center;
    }
    h3, h1, p {
      text-align: center;
      color: #fff;
    }
    button {
      display: block;
      width: 100%;
      margin: 0.5em 0;
      padding: 0.75em;
      background: #444;
      color: #fff;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #666;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5em;
      margin-top: 1em;
    }
    .grid-cell {
      font-size: 1.5em;
      padding: 1em;
      background: #444;
      color: #fff;
      border-radius: 5px;
      border: 1px solid #666;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="game">Loading...</div>
  <script>
    const prologueData = {
      npc: {
        name: "Blaze",
        intro: "Yo, you lookin‚Äô to level up? Take this burner ‚Äì your new hustle starts now.",
        portrait: "üßî"
      },
      questions: [
        { text: "You down to run this package?", options: [
          { label: "No questions asked.", outcomes: { xp: 5, heat: 2, rep: 3 } },
          { label: "What's in it?", outcomes: { rp: 2, xp: 2 } }
        ]},
        { text: "Where you wanna stash your cash?", options: [
          { label: "In my sock.", outcomes: { cash: 10, heat: 1 } },
          { label: "Bury it.", outcomes: { rp: 1, rep: 1 } }
        ]},
        { text: "Someone watching you?", options: [
          { label: "Ignore it.", outcomes: { heat: 2, rep: 2 } },
          { label: "Take the alley.", outcomes: { energy: -1, xp: 3 } }
        ]},
        { text: "You see a dropped bag.", options: [
          { label: "Grab and run.", outcomes: { cash: 20, heat: 3 } },
          { label: "Leave it.", outcomes: { rp: 1 } }
        ]},
        { text: "You get a weird text on the burner.", options: [
          { label: "Reply.", outcomes: { rp: 1, xp: 1 } },
          { label: "Ignore it.", outcomes: { rep: 1 } }
        ]}
      ],
      combat: {
        enemy: "Thug",
        enemyStats: { hp: 10, atk: 3 },
        playerStats: { hp: 12, atk: 4, energyCost: 1 },
        reward: { xp: 5, rep: 2, heat: 1 },
        failPenalty: { xp: -5, rep: -2, heat: 2 }
      },
      stashGame: {
        gridSize: 3,
        maxTries: 5,
        reward: { cash: 50, xp: 5 }
      }
    };

    let currentStep = 0;
    let playerStats = { hp: 12, energy: 5, cash: 0, rp: 0, xp: 0, rep: 0, heat: 0 };
    let playerInventory = { energyDrink: 1, medKit: 1 };
    let triesLeft, stashLocation, stashFound, enemyHP;

    function icon(k) {
      return { hp: '‚ù§Ô∏è', energy: '‚ö°', cash: 'üíµ', rp: 'üß†', xp: '‚≠ê', rep: 'üì¢', heat: 'üî•' }[k] || '';
    }

    function render() {
      const container = document.getElementById('game');
      container.innerHTML = '';

      if (currentStep === 0) {
        container.innerHTML = `<div class="question-box">
          <h1>${prologueData.npc.portrait} ${prologueData.npc.name}</h1>
          <p>"${prologueData.npc.intro}"</p>
          <button onclick="nextQuestion()">üì± Continue</button>
        </div>`;
      } else if (currentStep <= 5) {
        const q = prologueData.questions[currentStep - 1];
        let html = `<div class="question-box"><h3>Q${currentStep}</h3><p>${q.text}</p>`;
        q.options.forEach((opt, i) => {
          html += `<button onclick="choose(${i})">${opt.label}</button>`;
        });
        html += '</div>';
        container.innerHTML = html;
      } else if (currentStep === 6) {
        renderCombat();
      } else if (currentStep === 7) {
        renderCombatResult();
      } else if (currentStep === 8) {
        renderStash();
      } else if (currentStep === 9) {
        renderStashResult();
      } else {
        renderReward();
      }
    }

    function nextQuestion() {
      currentStep++;
      render();
    }

    function choose(optIndex) {
      const outcomes = prologueData.questions[currentStep - 1].options[optIndex].outcomes;
      for (let k in outcomes) {
        playerStats[k] = (playerStats[k] || 0) + outcomes[k];
      }
      currentStep++;
      render();
    }

    function renderCombat() {
      enemyHP = prologueData.combat.enemyStats.hp;
      const html = `<div class="combat-ui">
        <h3>üëä Boss Fight: ${prologueData.combat.enemy}</h3>
        <p>‚ù§Ô∏è You: ${playerStats.hp} | ‚ö° Energy: ${playerStats.energy}</p>
        <p>üíÄ Enemy: ${enemyHP}</p>
        <button onclick="combatTurn()">üëä Attack (‚ö° -${prologueData.combat.playerStats.energyCost})</button>
        <button onclick="useEnergy()">‚ö° Use Energy Drink (${playerInventory.energyDrink})</button>
        <button onclick="useMedKit()">ü©π Use Med Kit (${playerInventory.medKit})</button>
      </div>`;
      document.getElementById('game').innerHTML = html;
    }

    function combatTurn() {
      if (playerStats.energy < prologueData.combat.playerStats.energyCost) {
        alert("You're out of energy!");
        return;
      }
      playerStats.energy -= prologueData.combat.playerStats.energyCost;
      enemyHP -= prologueData.combat.playerStats.atk;
      playerStats.hp -= prologueData.combat.enemyStats.atk;

      if (enemyHP <= 0) {
        for (let k in prologueData.combat.reward) {
          playerStats[k] = (playerStats[k] || 0) + prologueData.combat.reward[k];
        }
        currentStep++;
        render();
      } else if (playerStats.hp <= 0) {
        for (let k in prologueData.combat.failPenalty) {
          playerStats[k] = (playerStats[k] || 0) + prologueData.combat.failPenalty[k];
        }
        playerStats = { hp: 12, energy: 5, cash: 0, rp: 0, xp: 0, rep: 0, heat: 0 };
        playerInventory = { energyDrink: 1, medKit: 1 };
        currentStep = 0;
        alert("You lost the fight! Stats reset.");
        render();
      } else {
        renderCombat();
      }
    }

    function useEnergy() {
      if (playerInventory.energyDrink > 0) {
        playerStats.energy += 3;
        playerInventory.energyDrink--;
        renderCombat();
      } else {
        alert("No energy drinks left!");
      }
    }

    function useMedKit() {
      if (playerInventory.medKit > 0) {
        playerStats.hp += 5;
        playerInventory.medKit--;
        renderCombat();
      } else {
        alert("No med kits left!");
      }
    }

    function renderCombatResult() {
      let html = `<div class="combat-result-box"><h3>ü•ä Combat Complete</h3>`;
      for (let k in prologueData.combat.reward) {
        html += `<p>${icon(k)} ${k.toUpperCase()}: +${prologueData.combat.reward[k]}</p>`;
      }
      html += `<button onclick="nextQuestion()">‚û°Ô∏è Continue</button></div>`;
      document.getElementById('game').innerHTML = html;
    }

    function renderStash() {
      triesLeft = prologueData.stashGame.maxTries;
      stashLocation = Math.floor(Math.random() * 9);
      stashFound = false;

      let html = `<div class="stash-grid"><h3>üéØ Find the Stash</h3><p>Tries left: ${triesLeft}</p><div class="grid">`;
      for (let i = 0; i < 9; i++) {
        html += `<button class="grid-cell" id="cell-${i}" onclick="pickCell(${i}, this)">‚ùì</button>`;
      }
      html += '</div></div>';
      document.getElementById('game').innerHTML = html;
    }

    function pickCell(i, el) {
      if (el.disabled) return;
      el.disabled = true;
      triesLeft--;
      if (i === stashLocation) {
        el.innerText = 'üí∞';
        stashFound = true;
        Object.entries(prologueData.stashGame.reward).forEach(([k, v]) => playerStats[k] += v);
      } else {
        el.innerText = '‚ùå';
      }
      document.querySelector(".stash-grid p").innerText = `Tries left: ${triesLeft}`;
      if (triesLeft <= 0 || stashFound) {
        setTimeout(() => { currentStep++; render(); }, 1000);
      }
    }

    function renderStashResult() {
      const html = `<div class="stash-result-box">
        <h3>${stashFound ? 'üí∞ You Found the Stash!' : 'üö´ You Failed to Find the Stash'}</h3>
        <p>${stashFound ? 'Nice pull. Bonus XP and Cash awarded.' : 'Better luck next time.'}</p>
        <button onclick="nextQuestion()">‚û°Ô∏è Continue</button>
      </div>`;
      document.getElementById('game').innerHTML = html;
    }

    function renderReward() {
      let html = `<div class="reward-box"><h3>üèÜ Mission Complete</h3>`;
      for (let k in playerStats) {
        html += `<p>${icon(k)} ${k.toUpperCase()}: ${playerStats[k]}</p>`;
      }
      html += `<p>üì¶ Inventory: ‚ö° Drinks (${playerInventory.energyDrink}) ü©π Med Kits (${playerInventory.medKit})</p>`;
      html += `<p>üì≤ Launching Burner OS...</p></div>`;
      document.getElementById('game').innerHTML = html;
      setTimeout(() => { window.location.href = '/p/burner-os.html'; }, 3000);
    }

    render();
  </script>
</body>
</html>
